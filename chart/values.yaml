apiVersion: minio.min.io/v2
# -- Values to pass to [the upstream minio chart](https://github.com/minio/operator/blob/master/helm/tenant/values.yaml)
# @default -- Upstream chart values
upstream:
  upgradeTenants:
    enabled: true
  tenant:
    image:
      repository: registry1.dso.mil/ironbank/opensource/minio/minio
      tag: RELEASE.2025-09-07T16-13-09Z
      pullPolicy: Always
    imagePullSecret:
      name: private-registry
    configSecret:
      accessKey: minio
      secretKey: minio123
    pools:
      - servers: 4
        name: pool-0
        volumesPerServer: 4
        size: 10Gi
        securityContext:
          runAsUser: 1001
          runAsGroup: 1001
          fsGroup: 1001
          fsGroupChangePolicy: "OnRootMismatch"
          runAsNonRoot: true
        containerSecurityContext:
          runAsUser: 1001
          runAsGroup: 1001
          runAsNonRoot: true
          allowPrivilegeEscalation: false
          capabilities:
            drop:
              - ALL
          seccompProfile:
            type: RuntimeDefault
    mountPath: /export
    subPath: /data
    metrics:
      enabled: false
      port: 9000
      protocol: http
    certificate:
      requestAutoCert: false
    features:
      bucketDNS: false
      enableSFTP: false
    podManagementPolicy: Parallel
    prometheusOperator: false

  ingress:
    api:
      enabled: false
      host: minio.local
      path: /
      pathType: Prefix
    console:
      enabled: false
      host: minio-console.local
      path: /
      pathType: Prefix

domain: dev.bigbang.mil

istio:
  enabled: false
  hardened:
    enabled: false
    customAuthorizationPolicies: []
    # - name: "allow-nothing"
    #   enabled: true
    #   spec: {}
    outboundTrafficPolicyMode: "REGISTRY_ONLY"
    customServiceEntries: []
      # - name: "allow-google"
      #   enabled: true
      #   spec:
      #     hosts:
      #       - google.com
      #     location: MESH_EXTERNAL
      #     ports:
      #       - number: 443
      #         protocol: TLS
      #         name: https
      #     resolution: DNS
    tempo:
      enabled: false
      namespaces:
      - tempo
      principals:
      - cluster.local/ns/tempo/sa/tempo-tempo
    minio:
      enabled: true
      namespaces:
      - minio
      principals:
      - cluster.local/ns/minio/sa/minio-minio-minio-instance-sa
    minioOperator:
      enabled: true
      namespaces:
      - minio-operator
      principals:
      - cluster.local/ns/minio-operator/sa/minio-operator
    velero:
      enabled: true
      namespaces:
      - velero
      principals:
      - cluster.local/ns/velero/sa/velero
  mtls:
    # STRICT = Allow only mutual TLS traffic
    # PERMISSIVE = Allow both plain text and mutual TLS traffic
    mode: STRICT
  console:
    enabled: true
    annotations: {}
    labels: {}
    gateways:
      - istio-system/main
    hosts:
      -  minio.{{ .Values.domain }}
    service: ""
    port: ""
  api:
    enabled: true
    annotations: {}
    labels: {}
    gateways:
      - istio-system/main
    hosts:
      -  minio-api.{{ .Values.domain }}
    service: ""
    port: ""

monitoring:
  enabled: false
  namespace: monitoring

networkPolicies:
  enabled: false
  controlPlaneCidr: 0.0.0.0/0
  ingressLabels:
    app: istio-ingressgateway
    istio: ingressgateway
  additionalPolicies: []

openshift: false

bbtests:
  enabled: false
  scripts:
    permissions:
      apiGroups:
        - ""
      resources:
        - configmaps
      verbs:
        - create
        - delete
        - list
        - get
    image: registry1.dso.mil/ironbank/opensource/minio/mc:RELEASE.2025-08-13T08-35-41Z
    envs:
      MINIO_HOST: 'http://minio'
    secretEnvs:
      - name: SECRET_KEY
        valueFrom:
          secretKeyRef:
            name: minio-access
            key: secretkey
      - name: ACCESS_KEY
        valueFrom:
          secretKeyRef:
            name: minio-access
            key: accesskey

waitJob:
  enabled: true
  scripts:
    image: registry1.dso.mil/ironbank/opensource/kubernetes/kubectl:v1.33.5
  permissions:
    apiGroups:
     - minio.min.io
     - minio.min.io/v2
    resources:
     - tenants
     - tenant
     - tenants.minio.min.io
